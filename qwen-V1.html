<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#1f2937" />
    <title>MindScape â€“ Capture, Organize, Act</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        sidebar: '#1f2937',
                        sidebarHover: '#374151',
                        accent: {
                            primary: '#3b82f6',
                            secondary: '#8b5cf6',
                            success: '#10b981',
                            danger: '#ef4444',
                            warn: '#f59e0b'
                        },
                        mindmap: {
                            node: '#4f46e5',
                            connection: '#94a3b8',
                            cluster: '#334155'
                        }
                    },
                    boxShadow: {
                        soft: '0 2px 4px -2px rgba(0,0,0,0.2), 0 4px 8px -1px rgba(0,0,0,0.15)',
                        strong: '0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1)'
                    }
                }
            }
        }
    </script>
    <!-- Lucide icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Manrope:wght@500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --sidebar-width: 18rem;
            --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --mindmap-node-size: 140px;
            --mindmap-node-padding: 12px;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: #111827;
            color: #f3f4f6;
        }

        .sidebar-transition {
            transition: transform var(--transition-base), width var(--transition-base);
        }

        .sidebar-open #appSidebar {
            transform: translateX(0);
        }

        .sidebar-closed #appSidebar {
            transform: translateX(calc(-1 * var(--sidebar-width)));
        }

        .content-transition {
            transition: margin-left var(--transition-base);
        }

        .mindmap-node {
            min-width: var(--mindmap-node-size);
            min-height: var(--mindmap-node-size);
            padding: var(--mindmap-node-padding);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .mindmap-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        .thin-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .thin-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .thin-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 4px;
        }

        .thin-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 0.25);
        }

        .node-cluster-1 {
            background: rgba(79, 70, 229, 0.1);
            border: 1px solid rgba(79, 70, 229, 0.3);
        }

        .node-cluster-2 {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .node-cluster-3 {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .task-swimlane {
            min-height: 120px;
            transition: all 0.2s ease;
        }

        .task-swimlane:hover {
            background-color: #1e293b;
        }

        .modal-overlay {
            backdrop-filter: blur(6px);
        }

        .modal-hidden {
            opacity: 0;
            pointer-events: none;
        }

        .modal-visible {
            opacity: 1;
        }

        .modal-panel {
            transform: scale(0.96);
            opacity: 0;
            transition: opacity var(--transition-base), transform var(--transition-base);
        }

        .modal-panel.show {
            opacity: 1;
            transform: scale(1);
        }

        .focus-outline:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .view-transition {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .view-enter {
            opacity: 0;
            transform: translateX(20px);
        }

        .view-exit {
            opacity: 0;
            transform: translateX(-20px);
        }

        .offline-indicator {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .mindmap-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .mindmap-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .node-connection {
            stroke: #94a3b8;
            stroke-width: 2;
            fill: none;
        }

        .today-panel {
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .today-panel.visible {
            transform: translateY(0);
        }

        /* Focus mode styles */
        .focus-mode #appSidebar {
            transform: translateX(calc(-1 * var(--sidebar-width) + 40px));
            opacity: 0.3;
        }

        .focus-mode main#content {
            margin-left: 40px;
        }

        .mindmap-node-content {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>

<body class="h-full antialiased relative">
    <!-- Offline indicator -->
    <div class="fixed bottom-4 right-4 z-50 flex items-center gap-2 px-3 py-1.5 bg-gray-800 rounded-full text-xs border border-gray-700 offline-indicator hidden"
        id="offlineIndicator">
        <span class="w-2 h-2 bg-yellow-400 rounded-full"></span>
        <span>Working offline</span>
    </div>

    <!-- Mobile & Desktop Sidebar Toggle / Top Bar -->
    <header
        class="flex items-center gap-2 px-4 h-14 border-b border-gray-800 bg-gray-900/70 backdrop-blur sticky top-0 z-30">
        <button id="sidebarToggle" aria-label="Toggle sidebar" aria-expanded="true"
            class="flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 transition"
            title="Toggle sidebar">
            <i data-lucide="panel-left" class="w-5 h-5"></i>
        </button>
        <h1 class="font-semibold tracking-tight text-lg select-none">MindScape</h1>
        <div class="ml-auto flex items-center gap-2">
            <button id="focusModeToggle"
                class="flex items-center justify-center w-10 h-10 rounded-md hover:bg-gray-800 transition"
                title="Focus Mode">
                <i data-lucide="maximize" class="w-5 h-5"></i>
            </button>
            <button id="quickCaptureBtn"
                class="flex items-center justify-center w-10 h-10 rounded-md bg-blue-600 hover:bg-blue-500 active:bg-blue-700 transition"
                title="Quick Capture (Ctrl+Space)">
                <i data-lucide="plus" class="w-5 h-5"></i>
            </button>
        </div>
    </header>

    <!-- Sidebar Backdrop (mobile) -->
    <div id="sidebar-backdrop" class="fixed inset-0 bg-black/40 hidden md:hidden z-40"></div>

    <!-- Sidebar -->
    <aside id="appSidebar" class="fixed top-0 left-0 h-full w-72 bg-sidebar border-r border-gray-800 flex flex-col z-50"
        aria-label="Primary Navigation">
        <!-- Top nav section -->
        <div class="pt-16 px-3 pb-2 space-y-2 border-b border-gray-700/60">
            <button id="newChatBtn"
                class="w-full flex items-center gap-2 px-3 py-2 rounded-md bg-blue-600 hover:bg-blue-500 active:bg-blue-700 transition text-sm font-medium focus-outline focus-visible:outline-blue-500"
                aria-label="Start a new chat">
                <i data-lucide="plus" class="w-4 h-4"></i>
                <span>New Chat</span>
            </button>
            <button id="searchOpenBtn"
                class="group w-full flex items-center gap-2 px-3 py-2 rounded-md hover:bg-sidebarHover transition text-sm font-medium focus-outline"
                aria-label="Search chats (Ctrl+K)" title="Search chats (Ctrl+K)">
                <i data-lucide="search" class="w-4 h-4 text-gray-300"></i>
                <span class="flex-1 text-left">Search chats</span>
                <kbd
                    class="hidden group-hover:inline-flex text-[10px] font-medium px-1.5 py-0.5 rounded bg-gray-700 text-gray-200 border border-gray-600">Ctrl
                    K</kbd>
            </button>
        </div>

        <!-- Middle features -->
        <nav class="px-3 py-3 space-y-1" aria-label="Main Features">
            <button
                class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-sidebarHover transition text-sm focus-outline active-feature"
                data-view="mindmap" aria-label="Mind Map View">
                <i data-lucide="map" class="w-5 h-5 text-blue-400"></i>
                <span class="flex-1 text-left">Mind Map</span>
            </button>
            <button
                class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-sidebarHover transition text-sm focus-outline"
                data-view="tasks" aria-label="Tasks View">
                <i data-lucide="list" class="w-5 h-5 text-gray-300"></i>
                <span class="flex-1 text-left">Tasks</span>
            </button>
            <button
                class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-sidebarHover transition text-sm focus-outline"
                data-view="knowledge" aria-label="Knowledge Base">
                <i data-lucide="book-open" class="w-5 h-5 text-gray-300"></i>
                <span class="flex-1 text-left">Knowledge Base</span>
            </button>
            <button
                class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-sidebarHover transition text-sm focus-outline"
                data-view="rituals" aria-label="Daily Rituals">
                <i data-lucide="sun" class="w-5 h-5 text-gray-300"></i>
                <span class="flex-1 text-left">Daily Rituals</span>
            </button>
        </nav>

        <!-- Chats history -->
        <section class="flex-1 min-h-0 flex flex-col" aria-label="Chat history">
            <header
                class="flex items-center justify-between px-3 py-2 text-xs uppercase tracking-wide text-gray-400 font-medium">
                <span>Recent Chats</span>
                <span id="chatCount" class="text-gray-500 text-[11px] bg-gray-700/50 rounded px-1.5 py-0.5">5</span>
            </header>
            <div id="chatListContainer" class="flex-1 overflow-y-auto thin-scrollbar px-2 pb-4" role="list"
                aria-label="Chats list">
                <ul id="chatList" class="space-y-1 text-sm">
                    <li class="chat-item group relative" role="listitem">
                        <button
                            class="chat-btn w-full flex items-center gap-2 px-3 py-2 rounded-md text-left hover:bg-sidebarHover transition focus-outline active"
                            data-chat-action="activate" title="Open chat">
                            <span class="pin-indicator hidden text-yellow-400"><i data-lucide="star"
                                    class="w-4 h-4 fill-yellow-400 stroke-yellow-400"></i></span>
                            <span class="chat-name flex-1">Product Strategy Brainstorm</span>
                        </button>
                        <div class="absolute inset-y-0 right-1 flex items-center">
                            <button
                                class="chat-menu-btn w-7 h-7 flex items-center justify-center rounded hover:bg-gray-700 text-gray-300 focus-outline"
                                data-chat-action="menu" aria-haspopup="true" aria-label="Open chat menu">
                                <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="chat-menu hidden absolute top-full right-2 mt-1 w-40 bg-gray-800 border border-gray-700 rounded-md shadow-soft z-10 p-1"
                            role="menu" aria-label="Chat options">
                            <button class="chat-menu-item" data-menu="pin">Pin</button>
                            <button class="chat-menu-item" data-menu="rename">Rename</button>
                            <button class="chat-menu-item" data-menu="archive">Archive</button>
                            <button class="chat-menu-item text-red-400 hover:text-red-300 focus-visible:outline-red-500"
                                data-menu="delete">Delete</button>
                        </div>
                    </li>
                    <li class="chat-item group relative" role="listitem">
                        <button
                            class="chat-btn w-full flex items-center gap-2 px-3 py-2 rounded-md text-left hover:bg-sidebarHover transition focus-outline"
                            data-chat-action="activate" title="Open chat">
                            <span class="pin-indicator hidden text-yellow-400"><i data-lucide="star"
                                    class="w-4 h-4 fill-yellow-400 stroke-yellow-400"></i></span>
                            <span class="chat-name flex-1">Meeting Notes - 2025-08-12</span>
                        </button>
                        <div class="absolute inset-y-0 right-1 flex items-center">
                            <button
                                class="chat-menu-btn w-7 h-7 flex items-center justify-center rounded hover:bg-gray-700 text-gray-300 focus-outline"
                                data-chat-action="menu" aria-haspopup="true" aria-label="Open chat menu">
                                <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </li>
                    <li class="chat-item group relative" role="listitem">
                        <button
                            class="chat-btn w-full flex items-center gap-2 px-3 py-2 rounded-md text-left hover:bg-sidebarHover transition focus-outline"
                            data-chat-action="activate" title="Open chat">
                            <span class="pin-indicator text-yellow-400"><i data-lucide="star"
                                    class="w-4 h-4 fill-yellow-400 stroke-yellow-400"></i></span>
                            <span class="chat-name flex-1">Weekly Planning</span>
                        </button>
                        <div class="absolute inset-y-0 right-1 flex items-center">
                            <button
                                class="chat-menu-btn w-7 h-7 flex items-center justify-center rounded hover:bg-gray-700 text-gray-300 focus-outline"
                                data-chat-action="menu" aria-haspopup="true" aria-label="Open chat menu">
                                <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </li>
                    <li class="chat-item group relative" role="listitem">
                        <button
                            class="chat-btn w-full flex items-center gap-2 px-3 py-2 rounded-md text-left hover:bg-sidebarHover transition focus-outline"
                            data-chat-action="activate" title="Open chat">
                            <span class="pin-indicator hidden text-yellow-400"><i data-lucide="star"
                                    class="w-4 h-4 fill-yellow-400 stroke-yellow-400"></i></span>
                            <span class="chat-name flex-1">Research - AI Tools</span>
                        </button>
                        <div class="absolute inset-y-0 right-1 flex items-center">
                            <button
                                class="chat-menu-btn w-7 h-7 flex items-center justify-center rounded hover:bg-gray-700 text-gray-300 focus-outline"
                                data-chat-action="menu" aria-haspopup="true" aria-label="Open chat menu">
                                <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </li>
                    <li class="chat-item group relative" role="listitem">
                        <button
                            class="chat-btn w-full flex items-center gap-2 px-3 py-2 rounded-md text-left hover:bg-sidebarHover transition focus-outline"
                            data-chat-action="activate" title="Open chat">
                            <span class="pin-indicator hidden text-yellow-400"><i data-lucide="star"
                                    class="w-4 h-4 fill-yellow-400 stroke-yellow-400"></i></span>
                            <span class="chat-name flex-1">Ideas for Side Project</span>
                        </button>
                        <div class="absolute inset-y-0 right-1 flex items-center">
                            <button
                                class="chat-menu-btn w-7 h-7 flex items-center justify-center rounded hover:bg-gray-700 text-gray-300 focus-outline"
                                data-chat-action="menu" aria-haspopup="true" aria-label="Open chat menu">
                                <i data-lucide="more-horizontal" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Bottom user account -->
        <div class="border-t border-gray-700/60 p-3">
            <button id="userMenuBtn"
                class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-sidebarHover transition text-left focus-outline"
                aria-haspopup="true" aria-expanded="false" aria-label="User menu">
                <img src="https://avatars.githubusercontent.com/u/1?v=4" alt="User avatar"
                    class="w-8 h-8 rounded-full object-cover border border-gray-600" />
                <div class="flex-1 min-w-0">
                    <p class="font-medium text-sm truncate">Alex Morgan</p>
                    <p class="text-[11px] text-gray-400">Pro Plan</p>
                </div>
                <i data-lucide="chevron-up" class="w-4 h-4 rotate-180 transition user-menu-chevron"></i>
            </button>
            <div id="userDropdown"
                class="mt-2 origin-bottom-left bg-gray-800 border border-gray-700 rounded-md shadow-soft p-1 divide-y divide-gray-700 hidden"
                role="menu" aria-label="User menu options">
                <div class="px-3 py-2 text-xs text-gray-300">alex.morgan@example.com</div>
                <div class="py-1 space-y-0.5">
                    <button class="menu-item" data-action="upgrade">Upgrade Plan</button>
                    <button class="menu-item" data-action="settings">Settings</button>
                    <button class="menu-item" data-action="help">Help Center</button>
                </div>
                <div class="pt-1">
                    <button class="menu-item text-red-400 hover:text-red-300 focus-visible:outline-red-500"
                        data-action="logout">Log Out</button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main content area -->
    <main id="content" class="relative min-h-[calc(100vh-3.5rem)] pt-4 px-4 transition-spacing-transform">
        <!-- Today's Focus Panel (Floating) -->
        <div class="today-panel visible fixed bottom-6 right-6 w-80 bg-gray-800 border border-gray-700 rounded-xl shadow-2xl z-40"
            id="todayPanel">
            <div class="p-4 border-b border-gray-700 flex items-center justify-between">
                <h3 class="font-medium flex items-center gap-2">
                    <i data-lucide="calendar" class="w-4 h-4 text-blue-400"></i>
                    Today's Focus
                </h3>
                <button id="closeTodayPanel" class="p-1 hover:bg-gray-700 rounded transition">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="p-4 space-y-3">
                <div class="flex items-start gap-2">
                    <div class="mt-1 w-2 h-2 rounded-full bg-blue-500"></div>
                    <div>
                        <p class="font-medium text-sm">Complete product roadmap draft</p>
                        <p class="text-xs text-gray-400 mt-1">Product Strategy Brainstorm Â· High priority</p>
                    </div>
                </div>
                <div class="flex items-start gap-2">
                    <div class="mt-1 w-2 h-2 rounded-full bg-purple-500"></div>
                    <div>
                        <p class="font-medium text-sm">Research AI tools for knowledge management</p>
                        <p class="text-xs text-gray-400 mt-1">Research - AI Tools Â· Medium priority</p>
                    </div>
                </div>
                <div class="flex items-start gap-2">
                    <div class="mt-1 w-2 h-2 rounded-full bg-green-500"></div>
                    <div>
                        <p class="font-medium text-sm">Schedule team meeting for planning</p>
                        <p class="text-xs text-gray-400 mt-1">Weekly Planning Â· Low priority</p>
                    </div>
                </div>
                <button
                    class="w-full mt-2 flex items-center justify-center gap-2 px-3 py-2 rounded-md bg-blue-600 hover:bg-blue-500 transition text-sm font-medium">
                    <i data-lucide="plus" class="w-4 h-4"></i>
                    <span>Add Task</span>
                </button>
            </div>
        </div>

        <!-- View Container -->
        <div class="max-w-7xl mx-auto">
            <!-- Mind Map View (Default) -->
            <div id="mindmapView" class="view-container active">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold mb-1">Knowledge Graph</h2>
                        <p class="text-gray-400 text-sm">Visualize connections between your ideas and tasks</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            class="px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 border border-gray-700 text-sm flex items-center gap-2 transition">
                            <i data-lucide="layout-grid" class="w-4 h-4"></i>
                            <span>Clustering</span>
                        </button>
                        <button
                            class="px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 border border-gray-700 text-sm flex items-center gap-2 transition">
                            <i data-lucide="zoom-in" class="w-4 h-4"></i>
                            <span>Zoom</span>
                        </button>
                    </div>
                </div>

                <!-- Mind Map Canvas -->
                <div class="relative rounded-xl overflow-hidden border border-gray-800 bg-gray-900/50 h-[600px]">
                    <div class="mindmap-container">
                        <!-- Connection lines will be drawn here via JS -->
                        <svg class="mindmap-canvas" id="mindmapConnections"></svg>

                        <!-- Nodes -->
                        <div class="absolute" style="top: 200px; left: 100px;">
                            <div class="mindmap-node bg-gray-800/50 border border-blue-500/30 node-cluster-1">
                                <div class="p-3 h-full">
                                    <div class="flex items-center justify-between mb-2">
                                        <span
                                            class="text-xs px-2 py-1 rounded-full bg-blue-500/20 text-blue-300">Project</span>
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-3 h-3 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <h3 class="font-medium text-sm mb-2 line-clamp-2">Product Strategy Brainstorm</h3>
                                    <p class="text-xs text-gray-400 mindmap-node-content">
                                        Exploring new features for knowledge management application. Focus on
                                        AI-assisted mind mapping and task conversion.
                                    </p>
                                    <div class="mt-3 flex items-center justify-between text-xs">
                                        <span class="text-gray-500">Today</span>
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="message-square" class="w-3 h-3 text-gray-500"></i>
                                            <span class="text-gray-500">3</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="absolute" style="top: 100px; left: 300px;">
                            <div class="mindmap-node bg-gray-800/50 border border-purple-500/30 node-cluster-2">
                                <div class="p-3 h-full">
                                    <div class="flex items-center justify-between mb-2">
                                        <span
                                            class="text-xs px-2 py-1 rounded-full bg-purple-500/20 text-purple-300">Research</span>
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-3 h-3 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <h3 class="font-medium text-sm mb-2 line-clamp-2">AI Tools for Knowledge Management
                                    </h3>
                                    <p class="text-xs text-gray-400 mindmap-node-content">
                                        Comparing different AI approaches for transforming raw inputs into structured
                                        outcomes. Focus on semantic analysis and context awareness.
                                    </p>
                                    <div class="mt-3 flex items-center justify-between text-xs">
                                        <span class="text-gray-500">Yesterday</span>
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="file-text" class="w-3 h-3 text-gray-500"></i>
                                            <span class="text-gray-500">2</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="absolute" style="top: 300px; left: 350px;">
                            <div class="mindmap-node bg-gray-800/50 border border-green-500/30 node-cluster-3">
                                <div class="p-3 h-full">
                                    <div class="flex items-center justify-between mb-2">
                                        <span
                                            class="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300">Task</span>
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-3 h-3 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <h3 class="font-medium text-sm mb-2 line-clamp-2">Complete Product Roadmap Draft
                                    </h3>
                                    <p class="text-xs text-gray-400 mindmap-node-content">
                                        Finalize the product roadmap for the next quarter. Include AI coaching features
                                        and knowledge base enhancements.
                                    </p>
                                    <div class="mt-3 flex items-center justify-between text-xs">
                                        <span class="text-gray-500">Today</span>
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="calendar" class="w-3 h-3 text-gray-500"></i>
                                            <span class="text-gray-500">1</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="absolute" style="top: 250px; left: 550px;">
                            <div class="mindmap-node bg-gray-800/50 border border-yellow-500/30 node-cluster-1">
                                <div class="p-3 h-full">
                                    <div class="flex items-center justify-between mb-2">
                                        <span
                                            class="text-xs px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-300">Idea</span>
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-3 h-3 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <h3 class="font-medium text-sm mb-2 line-clamp-2">1% Daily Progress System</h3>
                                    <p class="text-xs text-gray-400 mindmap-node-content">
                                        Encourages small wins with streaks and achievements. Helps users maintain
                                        momentum even with limited time.
                                    </p>
                                    <div class="mt-3 flex items-center justify-between text-xs">
                                        <span class="text-gray-500">Aug 10</span>
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="lightbulb" class="w-3 h-3 text-gray-500"></i>
                                            <span class="text-gray-500">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="absolute" style="top: 150px; left: 500px;">
                            <div class="mindmap-node bg-gray-800/50 border border-cyan-500/30 node-cluster-2">
                                <div class="p-3 h-full">
                                    <div class="flex items-center justify-between mb-2">
                                        <span
                                            class="text-xs px-2 py-1 rounded-full bg-cyan-500/20 text-cyan-300">Meeting</span>
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-3 h-3 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <h3 class="font-medium text-sm mb-2 line-clamp-2">Team Planning Session</h3>
                                    <p class="text-xs text-gray-400 mindmap-node-content">
                                        Discussing sprint goals and feature priorities for the next two weeks. Focus on
                                        AI coaching and offline capabilities.
                                    </p>
                                    <div class="mt-3 flex items-center justify-between text-xs">
                                        <span class="text-gray-500">Aug 12</span>
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="users" class="w-3 h-3 text-gray-500"></i>
                                            <span class="text-gray-500">4</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="absolute" style="top: 400px; left: 250px;">
                            <div class="mindmap-node bg-gray-800/50 border border-rose-500/30 node-cluster-3">
                                <div class="p-3 h-full">
                                    <div class="flex items-center justify-between mb-2">
                                        <span
                                            class="text-xs px-2 py-1 rounded-full bg-rose-500/20 text-rose-300">Task</span>
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-3 h-3 text-gray-400"></i>
                                        </button>
                                    </div>
                                    <h3 class="font-medium text-sm mb-2 line-clamp-2">Schedule Team Meeting</h3>
                                    <p class="text-xs text-gray-400 mindmap-node-content">
                                        Coordinate with team members to schedule the weekly planning session. Need to
                                        find a time that works for everyone.
                                    </p>
                                    <div class="mt-3 flex items-center justify-between text-xs">
                                        <span class="text-gray-500">Tomorrow</span>
                                        <div class="flex items-center gap-1">
                                            <i data-lucide="calendar" class="w-3 h-3 text-gray-500"></i>
                                            <span class="text-gray-500">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mind Map Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                    <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center">
                                <i data-lucide="map-pin" class="w-5 h-5 text-blue-400"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400">Total Nodes</p>
                                <p class="text-2xl font-bold">24</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center">
                                <i data-lucide="connection" class="w-5 h-5 text-purple-400"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400">Connections</p>
                                <p class="text-2xl font-bold">18</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center">
                                <i data-lucide="activity" class="w-5 h-5 text-green-400"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-400">Active Today</p>
                                <p class="text-2xl font-bold">5</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks View (Hidden by default) -->
            <div id="tasksView" class="view-container hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold mb-1">Task Management</h2>
                        <p class="text-gray-400 text-sm">Organize and prioritize your tasks with AI assistance</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            class="px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 border border-gray-700 text-sm flex items-center gap-2 transition">
                            <i data-lucide="filter" class="w-4 h-4"></i>
                            <span>Filter</span>
                        </button>
                        <button
                            class="px-3 py-1.5 rounded-md bg-blue-600 hover:bg-blue-500 border border-blue-500 text-sm flex items-center gap-2 text-white transition">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span>New Task</span>
                        </button>
                    </div>
                </div>

                <!-- Task Swimlanes -->
                <div class="space-y-6">
                    <div class="task-swimlane">
                        <div class="flex items-center justify-between mb-3 px-1">
                            <h3 class="font-semibold text-lg flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                                High Priority
                            </h3>
                            <span class="text-sm text-gray-400">3 tasks</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-blue-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Complete product roadmap draft</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Finalize the product roadmap
                                            for the next quarter including AI coaching features and knowledge base
                                            enhancements.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="px-2 py-1 rounded-full bg-blue-500/10 text-blue-300">Product
                                                Strategy</span>
                                            <span class="text-gray-500">Today</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-purple-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Prepare investor presentation</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Create slides for the
                                            upcoming investor meeting highlighting our unique approach to knowledge
                                            management.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-purple-500/10 text-purple-300">Investor</span>
                                            <span class="text-gray-500">Tomorrow</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-green-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Fix critical bug in offline sync</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Resolve the issue where
                                            attachments don't sync properly when coming back online after extended
                                            offline periods.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-green-500/10 text-green-300">Bug</span>
                                            <span class="text-gray-500">Today</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="task-swimlane">
                        <div class="flex items-center justify-between mb-3 px-1">
                            <h3 class="font-semibold text-lg flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                                Medium Priority
                            </h3>
                            <span class="text-sm text-gray-400">5 tasks</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-purple-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Research AI tools for knowledge
                                            management</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Compare different AI
                                            approaches for transforming raw inputs into structured outcomes with focus
                                            on semantic analysis.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-purple-500/10 text-purple-300">Research</span>
                                            <span class="text-gray-500">Yesterday</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-cyan-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Team planning session</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Discuss sprint goals and
                                            feature priorities for the next two weeks with focus on AI coaching and
                                            offline capabilities.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300">Meeting</span>
                                            <span class="text-gray-500">Aug 12</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-blue-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Update documentation</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Revise the API documentation
                                            to include new endpoints for the knowledge graph and context matching
                                            engine.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-blue-500/10 text-blue-300">Docs</span>
                                            <span class="text-gray-500">Aug 14</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="task-swimlane">
                        <div class="flex items-center justify-between mb-3 px-1">
                            <h3 class="font-semibold text-lg flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-gray-500"></span>
                                Low Priority
                            </h3>
                            <span class="text-sm text-gray-400">2 tasks</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-yellow-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">1% Daily Progress System</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Implement the streak and
                                            achievement system to encourage users to maintain momentum with small daily
                                            wins.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-yellow-500/10 text-yellow-300">Idea</span>
                                            <span class="text-gray-500">Aug 10</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="rounded-xl border border-gray-800 bg-gray-800/40 p-4 hover:border-rose-500/50 transition group cursor-move">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <h4 class="font-medium mb-1 line-clamp-1">Schedule team meeting</h4>
                                        <p class="text-sm text-gray-400 line-clamp-2 mb-2">Coordinate with team members
                                            to schedule the weekly planning session. Need to find a time that works for
                                            everyone.</p>
                                        <div class="flex items-center gap-2 text-xs">
                                            <span
                                                class="px-2 py-1 rounded-full bg-rose-500/10 text-rose-300">Task</span>
                                            <span class="text-gray-500">Tomorrow</span>
                                        </div>
                                    </div>
                                    <div class="opacity-0 group-hover:opacity-100 transition">
                                        <button class="p-1 hover:bg-gray-700 rounded transition">
                                            <i data-lucide="more-horizontal" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Knowledge Base View -->
            <div id="knowledgeView" class="view-container hidden">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold mb-1">Knowledge Base</h2>
                        <p class="text-gray-400 text-sm">Your curated collection of articles, insights, and resources
                        </p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button
                            class="px-3 py-1.5 rounded-md bg-gray-800 hover:bg-gray-700 border border-gray-700 text-sm flex items-center gap-2 transition">
                            <i data-lucide="filter" class="w-4 h-4"></i>
                            <span>Filter</span>
                        </button>
                        <button
                            class="px-3 py-1.5 rounded-md bg-blue-600 hover:bg-blue-500 border border-blue-500 text-sm flex items-center gap-2 text-white transition">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span>Add Resource</span>
                        </button>
                    </div>
                </div>

                <!-- Knowledge Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div
                        class="rounded-xl border border-gray-800 bg-gray-800/40 overflow-hidden hover:border-blue-500/50 transition">
                        <div class="h-40 bg-gradient-to-br from-blue-900/20 to-purple-900/20 border-b border-gray-800">
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs px-2 py-1 rounded-full bg-blue-500/10 text-blue-300">Article</span>
                                <span class="text-xs text-gray-500">Today</span>
                            </div>
                            <h3 class="font-medium mb-2 line-clamp-2">The Future of AI-Assisted Knowledge Management
                            </h3>
                            <p class="text-sm text-gray-400 line-clamp-3 mb-4">
                                Exploring how AI can transform the way we capture, organize, and act on knowledge. Key
                                insights on context-aware systems and semantic understanding.
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="book-open" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-xs text-gray-500">5 min read</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-yellow-500"></i>
                                    <span class="text-xs text-gray-500">4.5</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="rounded-xl border border-gray-800 bg-gray-800/40 overflow-hidden hover:border-purple-500/50 transition">
                        <div class="h-40 bg-gradient-to-br from-purple-900/20 to-pink-900/20 border-b border-gray-800">
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span
                                    class="text-xs px-2 py-1 rounded-full bg-purple-500/10 text-purple-300">Video</span>
                                <span class="text-xs text-gray-500">Yesterday</span>
                            </div>
                            <h3 class="font-medium mb-2 line-clamp-2">Building Effective Mind Maps for Complex Ideas
                            </h3>
                            <p class="text-sm text-gray-400 line-clamp-3 mb-4">
                                Practical techniques for creating mind maps that actually help with thinking and
                                problem-solving, not just decoration. Case studies included.
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="video" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-xs text-gray-500">12 min</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-yellow-500"></i>
                                    <span class="text-xs text-gray-500">4.7</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="rounded-xl border border-gray-800 bg-gray-800/40 overflow-hidden hover:border-green-500/50 transition">
                        <div class="h-40 bg-gradient-to-br from-green-900/20 to-teal-900/20 border-b border-gray-800">
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs px-2 py-1 rounded-full bg-green-500/10 text-green-300">PDF</span>
                                <span class="text-xs text-gray-500">Aug 10</span>
                            </div>
                            <h3 class="font-medium mb-2 line-clamp-2">Cognitive Load Theory and Knowledge Management
                            </h3>
                            <p class="text-sm text-gray-400 line-clamp-3 mb-4">
                                How understanding cognitive load can help design better knowledge management systems
                                that reduce mental effort and improve retention.
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="file-text" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-xs text-gray-500">8 pages</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-yellow-500"></i>
                                    <span class="text-xs text-gray-500">4.3</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="rounded-xl border border-gray-800 bg-gray-800/40 overflow-hidden hover:border-yellow-500/50 transition">
                        <div
                            class="h-40 bg-gradient-to-br from-yellow-900/20 to-orange-900/20 border-b border-gray-800">
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span
                                    class="text-xs px-2 py-1 rounded-full bg-yellow-500/10 text-yellow-300">Note</span>
                                <span class="text-xs text-gray-500">Aug 8</span>
                            </div>
                            <h3 class="font-medium mb-2 line-clamp-2">1% Daily Progress System Implementation Ideas</h3>
                            <p class="text-sm text-gray-400 line-clamp-3 mb-4">
                                Notes from brainstorming session on how to implement a system that encourages small
                                daily progress with streaks and achievements.
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="edit" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-xs text-gray-500">Personal</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-yellow-500"></i>
                                    <span class="text-xs text-gray-500">4.8</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="rounded-xl border border-gray-800 bg-gray-800/40 overflow-hidden hover:border-cyan-500/50 transition">
                        <div class="h-40 bg-gradient-to-br from-cyan-900/20 to-blue-900/20 border-b border-gray-800">
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs px-2 py-1 rounded-full bg-cyan-500/10 text-cyan-300">Article</span>
                                <span class="text-xs text-gray-500">Aug 5</span>
                            </div>
                            <h3 class="font-medium mb-2 line-clamp-2">Offline-First Applications: Best Practices</h3>
                            <p class="text-sm text-gray-400 line-clamp-3 mb-4">
                                Comprehensive guide to building applications that work seamlessly offline with reliable
                                synchronization when connectivity is restored.
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="book-open" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-xs text-gray-500">8 min read</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-yellow-500"></i>
                                    <span class="text-xs text-gray-500">4.6</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="rounded-xl border border-gray-800 bg-gray-800/40 overflow-hidden hover:border-rose-500/50 transition">
                        <div class="h-40 bg-gradient-to-br from-rose-900/20 to-pink-900/20 border-b border-gray-800">
                        </div>
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs px-2 py-1 rounded-full bg-rose-500/10 text-rose-300">Video</span>
                                <span class="text-xs text-gray-500">Aug 3</span>
                            </div>
                            <h3 class="font-medium mb-2 line-clamp-2">The Psychology of Task Completion</h3>
                            <p class="text-sm text-gray-400 line-clamp-3 mb-4">
                                Understanding what motivates people to complete tasks and how to design systems that
                                leverage these psychological principles.
                            </p>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <i data-lucide="video" class="w-4 h-4 text-gray-500"></i>
                                    <span class="text-xs text-gray-500">15 min</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-500 fill-yellow-500"></i>
                                    <span class="text-xs text-gray-500">4.9</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Rituals View -->
            <div id="ritualsView" class="view-container hidden">
                <div
                    class="flex flex-col items-center justify-center py-12 bg-gray-800/30 rounded-xl border border-gray-800">
                    <div class="w-16 h-16 rounded-full bg-blue-500/10 flex items-center justify-center mb-4">
                        <i data-lucide="sun" class="w-8 h-8 text-blue-400"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Morning Briefing</h2>
                    <p class="text-gray-400 text-center max-w-md mb-6">Start your day with a focused plan. AI will help
                        you identify your top priorities based on your knowledge graph and tasks.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl">
                        <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center">
                                    <i data-lucide="map-pin" class="w-4 h-4 text-blue-400"></i>
                                </div>
                                <h3 class="font-medium">Top Priority</h3>
                            </div>
                            <p class="text-gray-300 mb-4">Complete product roadmap draft</p>
                            <p class="text-sm text-gray-400">This will help move the project forward and align the team
                                on next steps. Estimated completion: Today.</p>
                        </div>

                        <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 rounded-lg bg-purple-500/10 flex items-center justify-center">
                                    <i data-lucide="book-open" class="w-4 h-4 text-purple-400"></i>
                                </div>
                                <h3 class="font-medium">Knowledge Focus</h3>
                            </div>
                            <p class="text-gray-300 mb-4">Review AI Tools research</p>
                            <p class="text-sm text-gray-400">This will inform your decision on which AI approaches to
                                implement for the knowledge graph.</p>
                        </div>

                        <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center">
                                    <i data-lucide="calendar" class="w-4 h-4 text-green-400"></i>
                                </div>
                                <h3 class="font-medium">Today's Task</h3>
                            </div>
                            <p class="text-gray-300 mb-4">Fix critical bug in offline sync</p>
                            <p class="text-sm text-gray-400">This is blocking user experience for those working offline.
                                High impact fix.</p>
                        </div>

                        <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 rounded-lg bg-yellow-500/10 flex items-center justify-center">
                                    <i data-lucide="lightbulb" class="w-4 h-4 text-yellow-400"></i>
                                </div>
                                <h3 class="font-medium">Small Win</h3>
                            </div>
                            <p class="text-gray-300 mb-4">1% Daily Progress</p>
                            <p class="text-sm text-gray-400">Take 5 minutes to organize your knowledge base. Small steps
                                lead to big results.</p>
                        </div>
                    </div>

                    <button
                        class="mt-8 px-6 py-2.5 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium transition flex items-center gap-2">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        <span>Start Day</span>
                    </button>
                </div>

                <div
                    class="mt-8 flex flex-col items-center justify-center py-12 bg-gray-800/30 rounded-xl border border-gray-800">
                    <div class="w-16 h-16 rounded-full bg-purple-500/10 flex items-center justify-center mb-4">
                        <i data-lucide="moon" class="w-8 h-8 text-purple-400"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Evening Reflection</h2>
                    <p class="text-gray-400 text-center max-w-md mb-6">End your day with reflection. What went well?
                        What could be improved? How does today connect to your larger goals?</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl">
                        <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center">
                                    <i data-lucide="check-circle" class="w-4 h-4 text-green-400"></i>
                                </div>
                                <h3 class="font-medium">Accomplishments</h3>
                            </div>
                            <ul class="space-y-2">
                                <li class="flex items-start gap-2">
                                    <i data-lucide="circle" class="w-3 h-3 mt-1 text-green-400 fill-current"></i>
                                    <span class="text-sm">Completed roadmap draft</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="circle" class="w-3 h-3 mt-1 text-green-400 fill-current"></i>
                                    <span class="text-sm">Fixed offline sync bug</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="circle" class="w-3 h-3 mt-1 text-gray-500"></i>
                                    <span class="text-sm text-gray-400">Reviewed AI tools research</span>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-gray-800/50 border border-gray-800 rounded-xl p-5">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-8 h-8 rounded-lg bg-yellow-500/10 flex items-center justify-center">
                                    <i data-lucide="lightbulb" class="w-4 h-4 text-yellow-400"></i>
                                </div>
                                <h3 class="font-medium">Insights</h3>
                            </div>
                            <p class="text-sm text-gray-300 mb-2">The offline sync issue was more complex than initially
                                thought. Need to implement better error handling for large attachments.</p>
                            <p class="text-sm text-gray-300">The roadmap draft helped clarify our AI priorities -
                                knowledge graph should come before coaching features.</p>
                        </div>
                    </div>

                    <button
                        class="mt-8 px-6 py-2.5 bg-purple-600 hover:bg-purple-500 rounded-lg font-medium transition flex items-center gap-2">
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        <span>Complete Reflection</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Quick Capture Modal -->
    <div id="quickCaptureModal"
        class="fixed inset-0 z-[100] modal-overlay flex items-start justify-center pt-24 md:pt-40 px-4 modal-hidden">
        <div class="absolute inset-0 bg-black/60" data-modal-close></div>
        <div class="relative w-full max-w-2xl bg-gray-800 border border-gray-700 rounded-xl shadow-soft overflow-hidden modal-panel"
            role="dialog" aria-modal="true" aria-labelledby="captureDialogTitle">
            <div class="p-4 border-b border-gray-700 flex items-center">
                <h3 id="captureDialogTitle" class="text-lg font-medium flex-1">Quick Capture</h3>
                <button id="closeQuickCapture" class="p-2 hover:bg-gray-700 rounded transition"
                    aria-label="Close capture modal">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" for="captureInput">What would you like to
                        capture?</label>
                    <textarea id="captureInput"
                        class="w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-blue-500 min-h-[100px] resize-y"
                        placeholder="Type your thought, task, or idea here..."></textarea>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Capture Type</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button
                            class="flex flex-col items-center justify-center p-3 rounded-lg border border-gray-700 hover:bg-gray-700/50 transition capture-type active"
                            data-type="thought">
                            <i data-lucide="lightbulb" class="w-5 h-5 mb-2 text-yellow-400"></i>
                            <span class="text-sm">Thought</span>
                        </button>
                        <button
                            class="flex flex-col items-center justify-center p-3 rounded-lg border border-gray-700 hover:bg-gray-700/50 transition capture-type"
                            data-type="task">
                            <i data-lucide="list" class="w-5 h-5 mb-2 text-blue-400"></i>
                            <span class="text-sm">Task</span>
                        </button>
                        <button
                            class="flex flex-col items-center justify-center p-3 rounded-lg border border-gray-700 hover:bg-gray-700/50 transition capture-type"
                            data-type="note">
                            <i data-lucide="file-text" class="w-5 h-5 mb-2 text-green-400"></i>
                            <span class="text-sm">Note</span>
                        </button>
                        <button
                            class="flex flex-col items-center justify-center p-3 rounded-lg border border-gray-700 hover:bg-gray-700/50 transition capture-type"
                            data-type="idea">
                            <i data-lucide="sparkles" class="w-5 h-5 mb-2 text-purple-400"></i>
                            <span class="text-sm">Idea</span>
                        </button>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Attachments</label>
                    <div
                        class="border-2 border-dashed border-gray-700 rounded-lg p-6 text-center hover:border-blue-500/50 transition">
                        <i data-lucide="cloud-upload" class="w-8 h-8 mx-auto mb-2 text-gray-500"></i>
                        <p class="text-sm text-gray-400 mb-2">Drag & drop files here or</p>
                        <button class="text-blue-400 hover:text-blue-300 font-medium">Browse files</button>
                        <p class="text-xs text-gray-500 mt-2">Supports images, PDFs, and documents</p>
                    </div>
                </div>

                <div class="flex justify-end gap-2">
                    <button id="cancelCapture"
                        class="px-4 py-2 rounded-lg border border-gray-700 hover:bg-gray-700 transition">Cancel</button>
                    <button id="saveCapture"
                        class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white transition flex items-center gap-2">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        <span>Save & Process</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal"
        class="fixed inset-0 z-[100] modal-overlay flex items-start justify-center pt-24 md:pt-40 px-4 modal-hidden">
        <div class="absolute inset-0 bg-black/60" data-modal-close></div>
        <div class="relative w-full max-w-xl bg-gray-800 border border-gray-700 rounded-xl shadow-soft overflow-hidden modal-panel"
            role="dialog" aria-modal="true" aria-labelledby="searchDialogTitle">
            <div class="border-b border-gray-700 flex items-center px-3">
                <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
                <input id="searchInput" type="text" placeholder="Search chats..."
                    class="flex-1 bg-transparent px-3 py-3 focus:outline-none text-sm"
                    aria-label="Search chats input" />
                <kbd
                    class="hidden md:inline-flex text-[10px] font-medium px-1.5 py-0.5 rounded bg-gray-700 text-gray-200 border border-gray-600">Esc</kbd>
            </div>
            <ul id="searchResults" class="max-h-80 overflow-y-auto thin-scrollbar divide-y divide-gray-700"
                role="listbox" aria-label="Search results">
                <li class="result-item cursor-pointer flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-700/60 focus:bg-gray-700/60 active:bg-gray-700/60"
                    role="option">
                    <i data-lucide="message-square" class="w-4 h-4 text-gray-400"></i>
                    <span class="flex-1 truncate">Product Strategy Brainstorm</span>
                    <span class="text-[10px] text-gray-500">Today</span>
                </li>
                <li class="result-item cursor-pointer flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-700/60 focus:bg-gray-700/60"
                    role="option">
                    <i data-lucide="message-square" class="w-4 h-4 text-gray-400"></i>
                    <span class="flex-1 truncate">Meeting Notes - 2025-08-12</span>
                    <span class="text-[10px] text-gray-500">Yesterday</span>
                </li>
                <li class="result-item cursor-pointer flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-700/60 focus:bg-gray-700/60"
                    role="option">
                    <i data-lucide="message-square" class="w-4 h-4 text-gray-400"></i>
                    <span class="flex-1 truncate">Weekly Planning</span>
                    <span class="text-[10px] text-gray-500">Aug 10</span>
                </li>
                <li class="result-item cursor-pointer flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-700/60 focus:bg-gray-700/60"
                    role="option">
                    <i data-lucide="file-text" class="w-4 h-4 text-gray-400"></i>
                    <span class="flex-1 truncate">Research - AI Tools</span>
                    <span class="text-[10px] text-gray-500">Aug 8</span>
                </li>
                <li class="result-item cursor-pointer flex items-center gap-2 px-3 py-2 text-sm hover:bg-gray-700/60 focus:bg-gray-700/60"
                    role="option">
                    <i data-lucide="lightbulb" class="w-4 h-4 text-gray-400"></i>
                    <span class="flex-1 truncate">Ideas for Side Project</span>
                    <span class="text-[10px] text-gray-500">Aug 5</span>
                </li>
            </ul>
            <div class="p-2 text-[11px] text-gray-500 flex justify-between">
                <span>Use â†‘ â†“ to navigate â€¢ Enter to open</span>
                <span><kbd class="px-1 bg-gray-700 rounded">Esc</kbd> close</span>
            </div>
        </div>
    </div>

    <!-- Reusable styles for menu items -->
    <style>
        .menu-item,
        .chat-menu-item {
            width: 100%;
            text-align: left;
            display: block;
            font-size: 13px;
            padding: .5rem .625rem;
            border-radius: .375rem;
            color: #e5e7eb;
            background: transparent;
            transition: background-color 140ms ease, color 140ms ease;
        }

        .menu-item:hover,
        .chat-menu-item:hover {
            background: #374151;
        }

        .menu-item:focus-visible,
        .chat-menu-item:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        .chat-btn.active {
            background: #374151;
        }

        .capture-type.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
    </style>

    <!-- Main Script -->
    <script>
            ; (() => {
                // ===== State =====
                const state = {
                    sidebarOpen: true,
                    currentView: 'mindmap',
                    searchIndex: [],
                    offlineMode: false,
                    focusMode: false
                }

                const LS_KEYS = {
                    SIDEBAR: 'ms_sidebar_open',
                    VIEW: 'ms_current_view',
                    OFFLINE: 'ms_offline_mode'
                }

                // ===== Elements =====
                const els = {
                    body: document.body,
                    sidebar: document.getElementById('appSidebar'),
                    sidebarToggle: document.getElementById('sidebarToggle'),
                    sidebarBackdrop: document.getElementById('sidebar-backdrop'),
                    newChatBtn: document.getElementById('newChatBtn'),
                    chatList: document.getElementById('chatList'),
                    chatCount: document.getElementById('chatCount'),
                    searchOpenBtn: document.getElementById('searchOpenBtn'),
                    searchModal: document.getElementById('searchModal'),
                    searchInput: document.getElementById('searchInput'),
                    searchResults: document.getElementById('searchResults'),
                    userMenuBtn: document.getElementById('userMenuBtn'),
                    userDropdown: document.getElementById('userDropdown'),
                    quickCaptureBtn: document.getElementById('quickCaptureBtn'),
                    quickCaptureModal: document.getElementById('quickCaptureModal'),
                    closeQuickCapture: document.getElementById('closeQuickCapture'),
                    captureInput: document.getElementById('captureInput'),
                    captureTypes: document.querySelectorAll('.capture-type'),
                    saveCapture: document.getElementById('saveCapture'),
                    cancelCapture: document.getElementById('cancelCapture'),
                    offlineIndicator: document.getElementById('offlineIndicator'),
                    todayPanel: document.getElementById('todayPanel'),
                    closeTodayPanel: document.getElementById('closeTodayPanel'),
                    focusModeToggle: document.getElementById('focusModeToggle'),
                    views: {
                        mindmap: document.getElementById('mindmapView'),
                        tasks: document.getElementById('tasksView'),
                        knowledge: document.getElementById('knowledgeView'),
                        rituals: document.getElementById('ritualsView')
                    },
                    viewButtons: document.querySelectorAll('[data-view]')
                }

                // ===== Utilities =====
                function loadLocal() {
                    try {
                        const sb = localStorage.getItem(LS_KEYS.SIDEBAR)
                        state.sidebarOpen = sb === null ? true : sb === 'true'

                        const view = localStorage.getItem(LS_KEYS.VIEW) || 'mindmap'
                        state.currentView = view

                        const offline = localStorage.getItem(LS_KEYS.OFFLINE)
                        state.offlineMode = offline === 'true'
                    } catch (e) {
                        console.error('LoadLocal error', e)
                    }
                }

                function persistState() {
                    localStorage.setItem(LS_KEYS.SIDEBAR, String(state.sidebarOpen))
                    localStorage.setItem(LS_KEYS.VIEW, state.currentView)
                    localStorage.setItem(LS_KEYS.OFFLINE, String(state.offlineMode))
                }

                function switchView(viewName) {
                    // Hide all views
                    Object.values(els.views).forEach(view => {
                        view.classList.remove('active')
                        view.classList.add('hidden')
                    })

                    // Show selected view
                    const selectedView = els.views[viewName]
                    if (selectedView) {
                        selectedView.classList.remove('hidden')
                        selectedView.classList.add('active')
                    }

                    // Update active button
                    els.viewButtons.forEach(btn => {
                        if (btn.dataset.view === viewName) {
                            btn.classList.add('active-feature')
                        } else {
                            btn.classList.remove('active-feature')
                        }
                    })

                    state.currentView = viewName
                    persistState()
                }

                function toggleSidebar(force) {
                    if (typeof force === 'boolean') {
                        state.sidebarOpen = force
                    } else {
                        state.sidebarOpen = !state.sidebarOpen
                    }

                    if (state.sidebarOpen) {
                        els.body.classList.add('sidebar-open')
                        els.body.classList.remove('sidebar-closed')
                        els.sidebarToggle.setAttribute('aria-expanded', 'true')
                        showBackdrop(true)
                    } else {
                        els.body.classList.add('sidebar-closed')
                        els.body.classList.remove('sidebar-open')
                        els.sidebarToggle.setAttribute('aria-expanded', 'false')
                        showBackdrop(false)
                    }

                    persistState()
                }

                function showBackdrop(show) {
                    if (show) {
                        els.sidebarBackdrop.classList.remove('hidden')
                        requestAnimationFrame(() => els.sidebarBackdrop.classList.add('visible'))
                    } else {
                        els.sidebarBackdrop.classList.remove('visible')
                        els.sidebarBackdrop.addEventListener('transitionend', function h() {
                            els.sidebarBackdrop.classList.add('hidden')
                            els.sidebarBackdrop.removeEventListener('transitionend', h)
                        }, { once: true })
                    }
                }

                function toggleUserMenu(force) {
                    const isOpen = els.userDropdown.classList.contains('hidden')
                    if (typeof force === 'boolean') {
                        if ((isOpen && force) || (!isOpen && !force)) return
                    }

                    if (isOpen) {
                        els.userDropdown.classList.remove('hidden')
                        els.userMenuBtn.setAttribute('aria-expanded', 'true')
                        els.userMenuBtn.querySelector('.user-menu-chevron').classList.remove('rotate-180')
                    } else {
                        els.userDropdown.classList.add('hidden')
                        els.userMenuBtn.setAttribute('aria-expanded', 'false')
                        els.userMenuBtn.querySelector('.user-menu-chevron').classList.add('rotate-180')
                    }
                }

                function openQuickCapture() {
                    els.quickCaptureModal.classList.remove('modal-hidden')
                    requestAnimationFrame(() => {
                        els.quickCaptureModal.classList.add('modal-visible')
                        els.quickCaptureModal.querySelector('.modal-panel').classList.add('show')
                    })
                    els.captureInput.focus()
                }

                function closeQuickCaptureModal() {
                    els.quickCaptureModal.classList.remove('modal-visible')
                    els.quickCaptureModal.querySelector('.modal-panel').classList.remove('show')
                    els.quickCaptureModal.addEventListener('transitionend', function h() {
                        els.quickCaptureModal.classList.add('modal-hidden')
                        els.quickCaptureModal.removeEventListener('transitionend', h)
                    }, { once: true })
                }

                function openSearch() {
                    els.searchModal.classList.remove('modal-hidden')
                    requestAnimationFrame(() => {
                        els.searchModal.classList.add('modal-visible')
                        els.searchModal.querySelector('.modal-panel').classList.add('show')
                    })
                    els.searchInput.focus()
                }

                function closeSearch() {
                    els.searchModal.classList.remove('modal-visible')
                    els.searchModal.querySelector('.modal-panel').classList.remove('show')
                    els.searchModal.addEventListener('transitionend', function h() {
                        els.searchModal.classList.add('modal-hidden')
                        els.searchModal.removeEventListener('transitionend', h)
                    }, { once: true })
                }

                function toggleFocusMode() {
                    state.focusMode = !state.focusMode
                    if (state.focusMode) {
                        els.body.classList.add('focus-mode')
                        els.focusModeToggle.querySelector('i').setAttribute('data-lucide', 'minimize-2')
                    } else {
                        els.body.classList.remove('focus-mode')
                        els.focusModeToggle.querySelector('i').setAttribute('data-lucide', 'maximize')
                    }
                    lucide.createIcons()
                }

                function checkOnlineStatus() {
                    // For prototype, we'll simulate offline mode with a 15% chance
                    if (Math.random() < 0.15) {
                        state.offlineMode = true
                        els.offlineIndicator.classList.remove('hidden')
                    } else {
                        state.offlineMode = false
                        els.offlineIndicator.classList.add('hidden')
                    }
                    persistState()
                }

                // ===== Event Handlers =====
                function bindEvents() {
                    // Sidebar toggle
                    els.sidebarToggle.addEventListener('click', () => toggleSidebar())
                    els.sidebarBackdrop.addEventListener('click', () => toggleSidebar(false))

                    // View navigation
                    els.viewButtons.forEach(btn => {
                        btn.addEventListener('click', () => {
                            switchView(btn.dataset.view)
                            if (window.innerWidth < 1024) {
                                toggleSidebar(false)
                            }
                        })
                    })

                    // User menu
                    els.userMenuBtn.addEventListener('click', toggleUserMenu)
                    document.addEventListener('click', e => {
                        if (!els.userDropdown.contains(e.target) &&
                            !els.userMenuBtn.contains(e.target) &&
                            !els.userDropdown.classList.contains('hidden')) {
                            toggleUserMenu(false)
                        }
                    })

                    // Quick Capture
                    els.quickCaptureBtn.addEventListener('click', openQuickCapture)
                    els.closeQuickCapture.addEventListener('click', closeQuickCaptureModal)
                    els.cancelCapture.addEventListener('click', closeQuickCaptureModal)

                    els.captureTypes.forEach(typeBtn => {
                        typeBtn.addEventListener('click', () => {
                            els.captureTypes.forEach(btn => btn.classList.remove('active'))
                            typeBtn.classList.add('active')
                        })
                    })

                    // Search
                    els.searchOpenBtn.addEventListener('click', openSearch)
                    document.querySelectorAll('[data-modal-close]').forEach(el => {
                        el.addEventListener('click', () => {
                            closeSearch()
                            closeQuickCaptureModal()
                        })
                    })

                    // Today Panel
                    els.closeTodayPanel.addEventListener('click', () => {
                        els.todayPanel.classList.remove('visible')
                    })

                    // Focus Mode
                    els.focusModeToggle.addEventListener('click', toggleFocusMode)

                    // Keyboard shortcuts
                    document.addEventListener('keydown', e => {
                        // Ctrl+K or Cmd+K for search
                        if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
                            e.preventDefault()
                            openSearch()
                        }

                        // Ctrl+Space or Cmd+Space for quick capture
                        if ((e.ctrlKey || e.metaKey) && e.key === ' ') {
                            e.preventDefault()
                            openQuickCapture()
                        }

                        // Escape key
                        if (e.key === 'Escape') {
                            closeSearch()
                            closeQuickCaptureModal()
                            if (!els.userDropdown.classList.contains('hidden')) {
                                toggleUserMenu(false)
                            }
                        }
                    })

                    // Chat menu interactions
                    document.addEventListener('click', e => {
                        const menuBtn = e.target.closest('.chat-menu-btn')
                        if (menuBtn) {
                            const menu = menuBtn.closest('.chat-item').querySelector('.chat-menu')
                            menu.classList.toggle('hidden')
                            return
                        }

                        if (!e.target.closest('.chat-menu') &&
                            document.querySelector('.chat-menu:not(.hidden)')) {
                            document.querySelectorAll('.chat-menu').forEach(menu => {
                                menu.classList.add('hidden')
                            })
                        }
                    })
                }

                // ===== Initialization =====
                function init() {
                    loadLocal()

                    // Set initial state
                    if (state.sidebarOpen) {
                        els.body.classList.add('sidebar-open')
                    } else {
                        els.body.classList.add('sidebar-closed')
                    }

                    switchView(state.currentView)

                    // Check online status periodically
                    checkOnlineStatus()
                    setInterval(checkOnlineStatus, 30000)

                    // Initialize icons
                    lucide.createIcons()

                    // Bind events
                    bindEvents()

                    // For UX refinement - simulate connection
                    setTimeout(() => {
                        if (state.offlineMode) {
                            els.offlineIndicator.classList.remove('hidden')
                        }
                    }, 1000)
                }

                init()
            })()
    </script>
</body>

</html>